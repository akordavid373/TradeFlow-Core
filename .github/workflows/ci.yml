name: Rust CI

on:
  push:
      branches: [ "main" ]
        pull_request:
            branches: [ "main" ]

            env:
              CARGO_TERM_COLOR: always

              jobs:
                build_and_test:
                    name: Soroban Build & Test
                        runs-on: ubuntu-latest
                            steps:
                                  - uses: actions/checkout@v3

                                        - name: Install Rust Toolchain
                                                uses: actions-rs/toolchain@v1
                                                        with:
                                                                  toolchain: stable
                                                                            target: wasm32-unknown-unknown
                                                                                      override: true

                                                                                            - name: Cache Cargo Registry
                                                                                                    uses: actions/cache@v3
                                                                                                            with:
                                                                                                                      path: |
                                                                                                                                  ~/.cargo/registry
                                                                                                                                              ~/.cargo/git
                                                                                                                                                          target
                                                                                                                                                                    key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}

                                                                                                                                                                          - name: Install Soroban CLI
                                                                                                                                                                                  run: cargo install --locked soroban-cli --version 20.0.0

                                                                                                                                                                                        - name: Run Complete Build Cycle
                                                                                                                                                                                                run: make all
                                                                                                                                                                                                